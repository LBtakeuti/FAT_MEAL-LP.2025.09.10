# Supabaseデータ追加エラーの解決方法

## エラーの意味

「cannot truncate a table referenced in a foreign key constraint」というエラーは：
- `menu_item_images`という別のテーブルが存在している
- そのテーブルが`menu_items`を参照している（外部キー制約）
- そのため、`menu_items`だけを削除できない

## 解決方法

### 方法1: 既存データを残したままサンプルデータを追加（推奨）

既にデータがある場合は、そのまま追加するだけでOKです：

```sql
-- ここから下をすべてコピー --

INSERT INTO menu_items (name, description, price, calories, protein, fat, carbs, images, features, ingredients, allergens, stock)
VALUES 
  ('チキン南蛮弁当', 'ジューシーなチキン南蛮に特製タルタルソースをたっぷりかけました', 850, 750, 32, 25, 85, 
   ARRAY['/bento_1.jpeg'], 
   ARRAY['高タンパク', '人気No.1', '甘酢ダレ'], 
   ARRAY['鶏肉', '小麦粉', '卵', 'タルタルソース', 'キャベツ', '白米'],
   ARRAY['小麦', '卵', '乳'],
   300),
   
  ('鮭の塩焼き弁当', '脂ののった鮭を丁寧に焼き上げ、副菜と共にバランスよく詰めました', 780, 620, 28, 18, 72,
   ARRAY['/bento_1.jpeg'],
   ARRAY['低脂質', 'ヘルシー', 'DHA豊富'],
   ARRAY['鮭', 'ほうれん草', 'ひじき', '白米', '大根'],
   ARRAY['さけ', '大豆'],
   300),
   
  ('豚の生姜焼き弁当', '特製の生姜ダレで味付けした豚肉と、彩り豊かな野菜を組み合わせました', 820, 680, 26, 22, 78,
   ARRAY['/bento_1.jpeg'],
   ARRAY['スタミナ満点', 'ビタミンB豊富', '定番人気'],
   ARRAY['豚肉', '生姜', 'キャベツ', '人参', '白米'],
   ARRAY['豚肉', '小麦', '大豆'],
   300);

-- ここまでコピー --
```

### 方法2: 全データをリセットしてから追加

すべてのデータを削除してから新しく追加したい場合：

```sql
-- ここから下をすべてコピー --

-- 関連テーブルも含めてすべて削除
TRUNCATE menu_items CASCADE;

-- 新しくサンプルデータを追加
INSERT INTO menu_items (name, description, price, calories, protein, fat, carbs, images, features, ingredients, allergens, stock)
VALUES 
  ('チキン南蛮弁当', 'ジューシーなチキン南蛮に特製タルタルソースをたっぷりかけました', 850, 750, 32, 25, 85, 
   ARRAY['/bento_1.jpeg'], 
   ARRAY['高タンパク', '人気No.1', '甘酢ダレ'], 
   ARRAY['鶏肉', '小麦粉', '卵', 'タルタルソース', 'キャベツ', '白米'],
   ARRAY['小麦', '卵', '乳'],
   300),
   
  ('鮭の塩焼き弁当', '脂ののった鮭を丁寧に焼き上げ、副菜と共にバランスよく詰めました', 780, 620, 28, 18, 72,
   ARRAY['/bento_1.jpeg'],
   ARRAY['低脂質', 'ヘルシー', 'DHA豊富'],
   ARRAY['鮭', 'ほうれん草', 'ひじき', '白米', '大根'],
   ARRAY['さけ', '大豆'],
   300),
   
  ('豚の生姜焼き弁当', '特製の生姜ダレで味付けした豚肉と、彩り豊かな野菜を組み合わせました', 820, 680, 26, 22, 78,
   ARRAY['/bento_1.jpeg'],
   ARRAY['スタミナ満点', 'ビタミンB豊富', '定番人気'],
   ARRAY['豚肉', '生姜', 'キャベツ', '人参', '白米'],
   ARRAY['豚肉', '小麦', '大豆'],
   300);

-- ここまでコピー --
```

### 方法3: 既存データを確認してから決める

まず、何が入っているか確認：

```sql
-- ここから下をすべてコピー --

-- 現在のデータを確認
SELECT * FROM menu_items;

-- ここまでコピー --
```

データを確認してから、上記の方法1か方法2を選択してください。

## ポイント

- **CASCADE**を使うと、関連するテーブル（`menu_item_images`）のデータも一緒に削除されます
- 既存データを残したい場合は**方法1**
- 完全にリセットしたい場合は**方法2**
- よくわからない場合は**方法1**が安全です